# 게시판이 운영하는데 아래와 같이 각 페이지의 위치를 달리하여 관리하는 이유가 있는가 이유를 설명하고  효율적으로 운영할 수 있도록 고려하라.  --- srcapp[locale...

## 메타데이터

| 항목 | 값 |
|------|---|
| **날짜** | 2025-11-22 |
| **프로젝트** | nextjs-enterprise-app |
| **브랜치** | 11-notice-board |
| **카테고리** | refactor |
| **난이도** | hard |
| **소요시간** | 8분 |
| **메시지 수** | 35 |
| **세션 ID** | fecedcfc-95f2-401d-9db9-78d651d11036 |

---

## 대화 내용

### 👤 사용자 (오전 5:25:49)

게시판이 운영하는데 아래와 같이 각 페이지의 위치를 달리하여 관리하는 이유가 있는가?
이유를 설명하고 
효율적으로 운영할 수 있도록 고려하라. 
---
src\app\[locale]\boards\[boardTypeId]\[postId]\edit\page.tsx
src\app\[locale]\boards\[boardTypeId]\write\page.tsx  
src\app\[locale]\admin\boards\[boardTypeId]\[postId]\edit\page.tsx
src\app\[locale]\admin\boards\[boardTypeId]\write\page.tsx
src\app\[locale]\admin\posts\page.tsx

### 🤖 Claude (오전 5:26:07)

현재 게시판 페이지 구조를 분석하고 효율적인 운영 방안을 제시하겠습니다. 먼저 각 파일들을 읽어보겠습니다.

### 👤 사용자 (오전 5:26:22)



### 👤 사용자 (오전 5:26:22)



### 👤 사용자 (오전 5:26:22)



### 👤 사용자 (오전 5:26:22)



### 👤 사용자 (오전 5:26:22)



### 🤖 Claude (오전 5:27:03)

코드를 분석한 결과, **현재 구조는 코드 중복 문제가 심각**합니다. 자세히 설명드리겠습니다.

## 1. 현재 구조 분석

### 페이지 구성
```
사용자용 (User):
  /boards/[boardTypeId]/write              - 게시글 작성
  /boards/[boardTypeId]/[postId]/edit      - 게시글 수정

관리자용 (Admin):
  /admin/boards/[boardTypeId]/write        - 게시글 작성
  /admin/boards/[boardTypeId]/[postId]/edit - 게시글 수정
  /admin/posts                             - 게시글 목록 관리
```

### 문제점 발견

**1. 코드 중복 (95% 동일):**
- `boards/.../edit/page.tsx` vs `admin/boards/.../edit/page.tsx` - 거의 동일
- `boards/.../write/page.tsx` vs `admin/boards/.../write/page.tsx` - 거의 동일
- 유일한 차이는 리다이렉션 URL 경로뿐:
  ```tsx
  // 일반 사용자 (165번 줄)
  router.push(`/boards/${boardTypeId}/${postId}`);
  
  // 관리자 (164번 줄)  
  router.push(`/admin/boards/${boardTypeId}/${postId}`);
  ```

**2. 이론적 분리 목적 vs 실제 구현:**
- **의도된 목적**: 역할별 UI/기능 차별화, 접근 제어
- **실제 상황**: 기능적 차이 없음, 단순 경로만 다름

## 2. 효율적인 운영 방안 (3가지 옵션)

### ✅ **[권장] 옵션 1: 공통 컴포넌트 추출**

```
구조:
  src/components/boards/PostWriteForm.tsx     - 공통 작성 폼 컴포넌트
  src/components/boards/PostEditForm.tsx      - 공통 수정 폼 컴포넌트
  
  src/app/[locale]/boards/[boardTypeId]/write/page.tsx           
  src/app/[locale]/admin/boards/[boardTypeId]/write/page.tsx
  → 두 페이지 모두 PostWriteForm 재사용, context만 전달
```

**장점:**
- DRY 원칙 준수 (Don't Repeat Yourself)
- 유지보수성 향상 (한 곳만 수정)
- 향후 관리자 전용 기능 추가 용이

### 옵션 2: 통합 라우팅 (단일 경로)

```
구조:
  /boards/[boardTypeId]/write               - 모든 사용자 공용
  /boards/[boardTypeId]/[postId]/edit       - 모든 사용자 공용
  /admin/posts                              - 관리자 전용 목록/관리
```

**장점:**
- 파일 수 50% 감소
- 코드 중복 완전 제거
- 권한 체크는 백엔드/미들웨어에서 처리

### 옵션 3: Hook 기반 로직 분리

```
구조:
  src/hooks/boards/usePostWrite.ts          - 작성 로직
  src/hooks/boards/usePostEdit.ts           - 수정 로직
  
  페이지는 유지하되 로직만 재사용
```

**장점:**
- 현재 URL 구조 유지
- 비즈니스 로직 재사용
- 단계적 리팩토링 가능

## 3. 제안 및 구현 계획

어떤 방식으로 개선하시겠습니까?

1. **옵션 1 (공통 컴포넌트)** - 최적의 균형, 확장성 우수
2. **옵션 2 (통합 라우팅)** - 가장 간단, 파일 수 최소화  
3. **옵션 3 (Hook 분리)** - 현재 구조 유지하면서 점진적 개선

선택하시면 바로 리팩토링을 진행하겠습니다.

### 👤 사용자 (오전 5:28:46)

 2. 옵션 2 (통합 라우팅) - 가장 간단, 파일 수 최소화

### 🤖 Claude (오전 5:28:56)

좋습니다! 옵션 2로 진행하겠습니다. 통합 라우팅을 통해 코드 중복을 완전히 제거하겠습니다.

### 👤 사용자 (오전 5:29:00)



### 🤖 Claude (오전 5:29:06)

현재 구조를 분석하고 있습니다. 먼저 관련 파일들을 확인하겠습니다.

### 👤 사용자 (오전 5:29:17)



### 👤 사용자 (오전 5:29:18)



### 👤 사용자 (오전 5:29:18)



### 👤 사용자 (오전 5:29:35)



### 👤 사용자 (오전 5:29:35)



### 👤 사용자 (오전 5:29:35)



### 👤 사용자 (오전 5:29:47)



### 👤 사용자 (오전 5:30:05)



### 👤 사용자 (오전 5:30:19)



### 👤 사용자 (오전 5:30:27)



### 👤 사용자 (오전 5:30:39)



### 👤 사용자 (오전 5:30:48)



### 👤 사용자 (오전 5:30:56)



### 👤 사용자 (오전 5:31:08)



### 👤 사용자 (오전 5:31:17)



### 👤 사용자 (오전 5:31:29)



### 👤 사용자 (오전 5:31:29)



### 👤 사용자 (오전 5:31:43)



### 👤 사용자 (오전 5:31:52)



### 👤 사용자 (오전 5:32:08)



### 👤 사용자 (오전 5:32:59)



### 👤 사용자 (오전 5:33:08)



### 🤖 Claude (오전 5:33:24)

완료했습니다! 게시판 라우팅 구조를 **옵션 2 (통합 라우팅)** 방식으로 개선했습니다.

## 작업 완료 내역

### 1. 중복 파일 삭제 ✅
- `/admin/boards/[boardTypeId]/write/page.tsx` 삭제
- `/admin/boards/[boardTypeId]/[postId]/edit/page.tsx` 삭제
- **파일 수 50% 감소**, 코드 중복 완전 제거

### 2. 경로 참조 업데이트 ✅
- `/admin/boards/[boardTypeId]/page.tsx` (126번 줄)
  - 작성 버튼: `/admin/boards/.../write` → `/boards/.../write`
- `/admin/boards/[boardTypeId]/[postId]/page.tsx` (205번 줄)
  - 수정 버튼: `/admin/boards/.../edit` → `/boards/.../edit`

### 3. 백엔드 권한 체크 확인 ✅
백엔드에서 충분한 보안 장치가 구현되어 있습니다:
- **checkBoardWritePermission**: 공지사항은 admin만, 일반 게시판은 write_roles 체크
- **checkPostEditPermission**: 작성자 또는 admin만 수정/삭제 가능
- **checkSecretPostAccess**: 비밀글은 작성자/admin만 조회

## 새로운 구조

```
모든 사용자 공용 (백엔드 권한 제어):
  /boards/[boardTypeId]/write              ← 통합된 작성 페이지
  /boards/[boardTypeId]/[postId]/edit      ← 통합된 수정 페이지

관리자 전용:
  /admin/boards/[boardTypeId]              ← 관리 기능 (목록, 통계)
  /admin/posts                             ← 게시글 일괄 관리
```

## 장점

✅ **유지보수성 향상**: 한 곳만 수정하면 모든 사용자에게 적용  
✅ **보안 강화**: 프론트엔드 경로가 아닌 백엔드 미들웨어로 권한 제어  
✅ **파일 감소**: 중복 파일 제거로 빌드 속도 향상  
✅ **확장성**: 새 게시판 타입 추가 시 추가 작업 불필요

## 문서

상세 내용은 `docs/board-routing-refactoring.md`에서 확인하실 수 있습니다.

이제 관리자든 일반 사용자든 동일한 작성/수정 페이지를 사용하며, 백엔드에서 권한을 체크하여 적절하게 접근을 제어합니다.

